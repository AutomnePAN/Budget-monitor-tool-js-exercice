"use strict";var budgetController=function(){function c(e,t,n){this.id=e,this.description=t,this.value=n,this.percentage=-1}c.prototype.calcPercentage=function(e){this.percentage=0<e?Math.round(100*this.value/e):-1},c.prototype.getPercentage=function(){return this.percentage};function a(e,t,n){this.id=e,this.description=t,this.value=n}function e(e){var i=0;l.allItems[e].forEach(function(e,t,n){i+=e.value}),l.totals[e]=i}var l={allItems:{exp:[],inc:[]},totals:{exp:0,inc:0},budget:0,percentage:-1};return{addItem:function(e,t,n){var i;return ID=0<l.allItems[e].length?l.allItems[e][l.allItems[e].length-1].id+1:0,"exp"===e?i=new c(ID,t,n):"inc"===e&&(i=new a(ID,t,n)),l.allItems[e].push(i),i},deleteItem:function(e,t){var n=l.allItems[e].map(function(e,t,n){return e.id});index=n.indexOf(t),-1!=index&&l.allItems[e].splice(index,1)},calculateBudget:function(){e("exp"),e("inc"),l.budget=l.totals.inc-l.totals.exp,0<l.totals.inc?l.percentage=Math.round(l.totals.exp/l.totals.inc*100):l.percentage=-1},calculatePercentage:function(){l.allItems.exp.forEach(function(e){e.calcPercentage(l.totals.inc)})},getBudget:function(){return{budget_:l.budget,totalInc:l.totals.inc,totalExp:l.totals.exp,percentage:l.percentage}},getPercentages:function(){return l.allItems.exp.map(function(e){return e.getPercentage()})},test:function(){console.log(l)}}}(),UIController=function(){function c(e,t){var n,i=(n=(e=(e=Math.abs(e)).toFixed(2)).split("."))[0],c=n[1];return 3<i.length&&(i=i.substr(0,i.length-3)+","+i.substr(i.length-3,3)),("exp"===t?"-":"+")+i+"."+c}var a={inputType:".add__type",inputDescription:".add__description",inputValue:".add__value",inputBtn:".add__btn",incomeContainer:".income__list",expensesContainer:".expenses__list",budgetLabel:".budget__value",incomeLabel:".budget__income--value",expensesLabel:".budget__expenses--value",percentageLabel:".budget__expenses--percentage",container:".container",expensesPercLabel:".item__percentage",dateLabel:".budget__title--month"};return{getInput:function(){return{type:document.querySelector(a.inputType).value,description:document.querySelector(a.inputDescription).value,value:parseFloat(document.querySelector(a.inputValue).value)}},addListItems:function(e,t){var n,i;"inc"===t?(element=a.incomeContainer,n='<div class="item clearfix" id="inc-%id%"> <div class="item__description">%description%</div><div class="right clearfix"><div class="item__value">%value%</div> <div class="item__delete"> <button class="item__delete--btn"><i class="ion-ios-close-outline"></i></button></div></div></div>'):"exp"===t&&(element=a.expensesContainer,n='<div class="item clearfix" id="exp-%id%"><div class="item__description">%description%</div><div class="right clearfix"><div class="item__value">%value%</div><div class="item__percentage">21%</div><div class="item__delete"><button class="item__delete--btn"><i class="ion-ios-close-outline"></i></button></div></div></div>'),i=(i=(i=n.replace("%id%",e.id)).replace("%description%",e.description)).replace("%value%",c(e.value,t)),document.querySelector(element).insertAdjacentHTML("beforeend",i)},deleteListItem:function(e){var t=document.getElementById(e);t.parentNode.removeChild(t)},clearFields:function(){var e=document.querySelectorAll(a.inputDescription+", "+a.inputValue),t=Array.prototype.slice.call(e);t.forEach(function(e,t,n){e.value=""}),t[0].focus()},displayBudget:function(e){var t=e.budget_<0?"exp":"inc";console.log(e),document.querySelector(a.budgetLabel).textContent=c(e.budget_,t),document.querySelector(a.incomeLabel).textContent=c(e.totalInc,"inc"),document.querySelector(a.expensesLabel).textContent=c(e.totalExp,"exp"),0<e.percentage?document.querySelector(a.percentageLabel).textContent=e.percentage:document.querySelector(a.percentageLabel).textContent="---"},displayPercentages:function(n){!function(e,t){for(var n=0;n<e.length;n++)t(e[n],n)}(document.querySelectorAll(a.expensesPercLabel),function(e,t){0<n[t]?e.textContent=n[t]+"%":e.textContent="---"})},displayMonth:function(){var e,t,n,i=new Date;months=["Jan","Feb","March","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"],e=i.getFullYear(),t=i.getMonth(),n=i.getDate(),i.getDay(),document.querySelector(a.dateLabel).textContent=e+" "+months[t]+" "+n+"th"},changeType:function(){!function(e,t){for(var n=0;n<e.length;n++)t(e[n],n)}(document.querySelectorAll(a.inputType+", "+a.inputDescription+", "+a.inputValue),function(e){e.classList.toggle("red-focus")}),document.querySelector(a.inputBtn).classList.toggle("red")},getDOMstrings:function(){return a}}}(),controller=function(n,i){function c(){n.calculateBudget();var e=n.getBudget();console.log(e),i.displayBudget(e)}function a(){n.calculatePercentage();var e=n.getPercentages();i.displayPercentages(e)}var t=function(){var e,t=i.getInput();""!==t.description&&!isNaN(t.value)&&0<t.value&&(e=n.addItem(t.type,t.description,t.value),i.addListItems(e,t.type),i.clearFields(),c(),a())},l=function(e){var t=e.target.parentNode.parentNode.parentNode.parentNode.id;t&&(splitID=t.split("-"),type=splitID[0],ID=parseInt(splitID[1]),console.log(ID),n.deleteItem(type,ID),i.deleteListItem(t),c(),a())};return{init:function(){var e;console.log("Application has started"),e=i.getDOMstrings(),document.querySelector(i.getDOMstrings().inputBtn).addEventListener("click",t),document.addEventListener("keypress",function(e){13!==e.keyCode&&13!==e.which||t()}),document.querySelector(e.container).addEventListener("click",l),document.querySelector(e.inputType).addEventListener("change",i.changeType),i.displayMonth(),i.displayBudget({budget_:0,totalInc:0,totalExp:0,percentage:-1})}}}(budgetController,UIController);controller.init();